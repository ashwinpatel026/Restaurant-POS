// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  role      UserRole
  isActive  Boolean  @default(true)
  outletId  Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Outlet {
  id          Int      @id @default(autoincrement())
  name        String
  code        String   @unique
  address     String
  city        String
  state       String
  zipCode     String
  phone       String
  email       String
  isActive    Boolean  @default(true)
  openingTime String
  closingTime String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("outlets")
}

model TimeEvent {
  id                     BigInt    @id @default(autoincrement())
  eventCode              String    @unique @map("Event_code") @db.VarChar(100)
  eventName              String    @map("EventName") @db.VarChar(100)
  globalPriceAmountAdd   Decimal?  @map("GlobalPrice_Amount_Add") @db.Decimal(18, 2)
  globalPriceAmountDisc  Decimal?  @map("GlobalPrice_Amount_Disc") @db.Decimal(18, 2)
  globalPricePerAdd      Decimal?  @map("GlobalPrice_Per_Add") @db.Decimal(18, 2)
  globalPricePerDisc     Decimal?  @map("GlobalPrice_Per_Disc") @db.Decimal(18, 2)
  monday                 String?   @map("Monday") @db.VarChar(50)
  monStartTime           String?   @map("Mon_StartTime") @db.VarChar(10)
  monEndTime             String?   @map("Mon_EndTime") @db.VarChar(10)
  tuesday                String?   @map("Tuesday") @db.VarChar(50)
  tueStartTime           String?   @map("Tue_StartTime") @db.VarChar(10)
  tueEndTime             String?   @map("Tue_EndTime") @db.VarChar(10)
  wednesday              String?   @map("Wednesday") @db.VarChar(50)
  wedStartTime           String?   @map("Wed_StartTime") @db.VarChar(10)
  wedEndTime             String?   @map("Wed_EndTime") @db.VarChar(10)
  thursday               String?   @map("Thursday") @db.VarChar(50)
  thuStartTime           String?   @map("Thu_StartTime") @db.VarChar(10)
  thuEndTime             String?   @map("Thu_EndTime") @db.VarChar(10)
  friday                 String?   @map("FriDay") @db.VarChar(50)
  friStartTime           String?   @map("Fri_StartTime") @db.VarChar(10)
  friEndTime             String?   @map("Fri_EndTime") @db.VarChar(10)
  saturday               String?   @map("Saturday") @db.VarChar(50)
  satStartTime           String?   @map("Sat_StartTime") @db.VarChar(10)
  satEndTime             String?   @map("Sat_EndTime") @db.VarChar(10)
  sunday                 String?   @map("SunDay") @db.VarChar(50)
  sunStartTime           String?   @map("Sun_StartTime") @db.VarChar(10)
  sunEndTime             String?   @map("Sun_EndTime") @db.VarChar(10)
  eventStartDate         DateTime? @map("Event_Start_Date") @db.Date
  eventEndDate           DateTime? @map("Event_End_Date") @db.Date
  isActive               Int?      @map("is_active")
  createdDate            DateTime? @map("Created_date")
  createdBy              Int?      @map("Created_by")
  storeCode              String?   @map("Store_code") @db.VarChar(30)
  isSyncToWeb            Int?      @map("is_sync_to_web")
  isSyncToLocal          Int?      @map("is_sync_to_local")

  // Relationships
  menuMasterEvents       MenuMasterEvent[]

  @@map("tbl_Time_Events")
}

model PrepZone {
  prepZoneId         BigInt    @id @default(autoincrement()) @map("prep_zone_id")
  prepZoneCode       String    @unique @map("prep_zone_code") @db.VarChar(100)
  prepZoneName       String?   @map("prep_zone_name") @db.VarChar(500)
  stationCode        String?   @map("station_code") @db.VarChar(100)
  isActive           Int       @default(1) @map("is_active")
  sendToExpediter    Int?      @map("send_to_expediter")
  alwaysPrintTicket  Int?      @map("always_print_ticket")
  printerCode        String?   @map("printer_code") @db.VarChar(100)
  backupPrinterCode  String?   @map("backup_printer_code") @db.VarChar(100)
  createdBy          Int?      @map("createdby")
  createdOn          DateTime  @default(now()) @map("createdon")
  updatedBy          Int?      @map("updatedby")
  updatedOn          DateTime? @map("updatedon")
  isSyncToWeb        Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal      Int       @default(0) @map("is_sync_to_local")
  storeCode          String?   @map("store_code") @db.VarChar(100)

  // Relationships
  printer Printer? @relation(fields: [printerCode], references: [printerCode])
  menuMasters MenuMaster[]

  @@map("tbl_prep_zone")
}

model MenuMaster {
  menuMasterId      BigInt    @id @default(autoincrement()) @map("menu_master_id")
  menuMasterCode    String    @unique @map("menu_master_code") @db.VarChar(100)
  name              String?   @map("name") @db.VarChar(500)
  labelName         String?   @map("label_name") @db.VarChar(500)
  colorCode         String?   @map("color_code") @db.VarChar(100)
  prepZoneCode      String?   @map("prep_zone_code") @db.VarChar(100)
  isEventMenu       Int?      @map("is_event_menu")
  isActive          Int       @default(1) @map("is_active")
  createdBy         Int?      @map("createdby")
  createdOn         DateTime  @default(now()) @map("createdon")
  updatedBy         Int?      @map("updatedby")
  updatedOn         DateTime? @map("updatedon")
  globalCode        String?   @map("global_code") @db.VarChar(30)
  isSyncToWeb       Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal     Int       @default(0) @map("is_sync_to_local")
  storeCode         String?   @map("store_code") @db.VarChar(100)

  // Relationships
  prepZone          PrepZone? @relation(fields: [prepZoneCode], references: [prepZoneCode])
  menuMasterEvents  MenuMasterEvent[]
  menuCategories    MenuCategory[]

  @@map("tbl_menu_master")
}

model MenuMasterEvent {
  id              BigInt    @id @default(autoincrement())
  menuMasterCode  String    @map("menu_master_code") @db.VarChar(100)
  eventCode       String    @map("event_code") @db.VarChar(100)
  createdBy       Int?      @map("createdby")
  createdOn       DateTime  @default(now()) @map("createdon")
  globalCode      String?   @map("global_code") @db.VarChar(30)
  isSyncToWeb     Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal   Int       @default(0) @map("is_sync_to_local")
  storeCode       String?   @map("store_code") @db.VarChar(100)

  // Relationships
  menuMaster      MenuMaster @relation(fields: [menuMasterCode], references: [menuMasterCode])
  timeEvent       TimeEvent  @relation(fields: [eventCode], references: [eventCode])

  @@map("tbl_menu_master_event")
}

model MenuCategory {
  menuCategoryId    BigInt    @id @default(autoincrement()) @map("menu_category_id")
  menuMasterCode    String    @map("menu_master_code") @db.VarChar(100)
  menuCategoryCode  String    @unique @map("menu_category_code") @db.VarChar(100)
  name              String?   @map("name") @db.VarChar(200)
  colorCode         String?   @map("color_code") @db.VarChar(100)
  isActive          Int       @default(1) @map("is_active")
  createdBy         Int?      @map("createdby")
  createdOn         DateTime  @default(now()) @map("createdon")
  globalCode        String?   @map("global_code") @db.VarChar(30)
  isSyncToWeb       Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal     Int       @default(0) @map("is_sync_to_local")
  storeCode         String?   @map("store_code") @db.VarChar(100)

  // Relationship
  menuMaster        MenuMaster @relation(fields: [menuMasterCode], references: [menuMasterCode])

  @@map("tbl_menu_category")
}

model MenuItem {
  menuItemId                     BigInt    @id @default(autoincrement()) @map("menu_item_id")
  menuItemCode                   String?   @map("menu_item_code") @db.VarChar(100)
  menuCategoryCode               String?   @map("menu_category_code") @db.VarChar(100)
  name                           String?   @map("name") @db.VarChar(500)
  kitchenName                    String?   @map("kitchen_name") @db.VarChar(150)
  labelName                      String?   @map("label_name") @db.VarChar(500)
  colorCode                      String?   @map("color_code") @db.VarChar(100)
  calories                       String?   @map("calories") @db.VarChar(100)
  description                    String?   @map("description")
  itemSize                       String?   @map("item_size") @db.VarChar(50)
  skuPlu                         BigInt?   @map("sku_plu")
  isAlcohol                      Int       @default(0) @map("is_alcohol")
  menuImg                        String?   @map("menu_img")
  priceStrategy                  Int?      @map("price_strategy")
  basePrice                      Decimal?  @map("base_price") @db.Decimal(10, 2)
  isPrice                        Int       @default(1) @map("is_price")
  isActive                       Int       @default(1) @map("is_active")
  stockinhand                    Decimal?  @map("stockinhand") @db.Decimal(18, 2)
  isOutStock                     Int?      @map("is_out_stock")
  itemContainAlcohol             Int?      @map("item_contain_alcohol")
  isPosVisible                   Int?      @map("is_pos_visible")
  isKioskOrderPay                Int?      @map("is_kiosk_order_pay")
  isOnlineOrderByApp             Int?      @map("is_online_order_by_app")
  isOnlineOrdering               Int?      @map("is_online_ordering")
  isCustomerInvoice              Int?      @map("is_customer_invoice")
  taxCode                        String?   @map("tax_code") @db.VarChar(50)
  inheritTaxInclusion            Boolean   @default(true) @map("inherit_tax_inclusion")
  isTaxIncluded                  Boolean   @default(false) @map("is_tax_included")
  inheritDiningTax               Boolean   @default(true) @map("inherit_dining_tax")
  diningTaxEffect                String?   @default("No Effect") @map("dining_tax_effect") @db.VarChar(50)
  disqualifyDiningTaxExemption   Boolean   @default(false) @map("disqualify_dining_tax_exemption")
  inheritModifierGroup           Boolean   @default(true) @map("inherit_modifier_group")
  createdBy                      Int?      @map("createdby")
  createdOn                      DateTime  @default(now()) @map("createdon")
  isSyncToWeb                    Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal                  Int       @default(0) @map("is_sync_to_local")
  storeCode                      String?   @map("store_code") @db.VarChar(100)

  @@map("tbl_menu_item")
}

model Tax {
  tblTaxId      Int      @id @default(autoincrement()) @map("tbl_tax_id")
  taxCode       String   @unique @map("tax_code") @db.VarChar(100)
  taxname       String   @map("taxname") @db.VarChar(30)
  taxrate       Decimal  @map("taxrate") @db.Decimal(22, 2) @default(0.00)
  createdBy     Int?     @map("created_by")
  createdDate   DateTime @default(now()) @map("created_date")
  isSyncToWeb   Int      @default(0) @map("is_sync_to_web")
  isSyncToLocal Int      @default(0) @map("is_sync_to_local")
  storeCode     String?  @map("store_code") @db.VarChar(100)

  @@map("tbl_tax")
}

model ModifierGroup {
  id                      BigInt   @id @default(autoincrement()) @map("id")
  modifierGroupCode       String?  @map("modifier_group_code") @db.VarChar(100)
  groupName               String?  @map("group_name") @db.VarChar(200)
  labelName               String?  @map("label_name") @db.VarChar(100)
  isRequired              Int      @default(0) @map("is_required")
  isMultiselect           Int      @default(0) @map("is_multiselect")
  minSelection            Int?     @map("min_selection")
  maxSelection            Int?     @map("max_selection")
  showDefaultTop          Int      @default(0) @map("show_default_top")
  inheritFromMenuGroup    Int      @default(0) @map("inherit_from_menu_group")
  menuCategoryCode        String?  @map("menu_category_code") @db.VarChar(100)
  priceStrategy           Int      @default(1) @map("price_strategy")
  price                   Decimal? @map("price") @db.Decimal(10, 2)
  isActive                Int      @default(1) @map("is_active")
  createdBy               Int?     @map("createdby")
  createdOn               DateTime @default(now()) @map("createdon")
  isSyncToWeb             Int      @default(0) @map("is_sync_to_web")
  isSyncToLocal           Int      @default(0) @map("is_sync_to_local")
  storeCode               String?  @map("store_code") @db.VarChar(100)

  // Items in this group (by code)
  // Note: Relation is via code; Prisma cannot enforce without FK. Use manual joins in API.

  @@map("tbl_modifier_group")
}

/// New modifier item table mapping to tbl_modifier_item
model ModifierItem {
  id                 BigInt   @id @default(autoincrement()) @map("id")
  modifierItemCode   String?  @map("modifier_item_code") @db.VarChar(100)
  modifierGroupCode  String?  @map("modifier_group_code") @db.VarChar(100)
  name               String?  @map("name") @db.VarChar(500)
  labelName          String?  @map("label_name") @db.VarChar(100)
  colorCode          String?  @map("color_code") @db.VarChar(100)
  price              Decimal? @map("price") @db.Decimal(10, 2)
  isDefault          Int      @default(0) @map("is_default")
  displayOrder       Int?     @map("display_order")
  isActive           Int      @default(1) @map("is_active")
  createdBy          Int?     @map("createdby")
  createdOn          DateTime @default(now()) @map("createdon")
  isSyncToWeb        Int      @default(0) @map("is_sync_to_web")
  isSyncToLocal      Int      @default(0) @map("is_sync_to_local")
  storeCode          String?  @map("store_code") @db.VarChar(100)

  @@map("tbl_modifier_item")
}

/// Menu item to modifier group assignment table
model MenuItemModifierGroup {
  id                   BigInt    @id @default(autoincrement()) @map("id")
  menuItemCode         String?   @map("menu_item_code") @db.VarChar(100)
  modifierGroupCode    String?   @map("modifier_group_code") @db.VarChar(100)
  inheritFromMenuGroup Int       @default(1) @map("inherit_from_menu_group")
  createdBy            Int?      @map("createdby")
  createdOn            DateTime  @default(now()) @map("createdon")
  isSyncToWeb          Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal        Int       @default(0) @map("is_sync_to_local")
  storeCode            String?   @map("store_code") @db.VarChar(100)

  // Relations are based on codes (no enforced FKs in DB schema)
  // menuItemCode -> MenuItem.menuCategoryCode (by code)
  // modifierGroupCode -> ModifierGroup.modifierGroupCode (by code)

  @@map("tbl_menu_item_modifier_group")
}

model Station {
  tblStationId  BigInt  @id @default(autoincrement()) @map("tbl_station_id")
  stationCode   String  @unique @map("station_code") @db.VarChar(100)
  stationname   String? @map("stationname") @db.VarChar(100)
  isActive      Int?    @map("is_active")
  isSyncToWeb   Int     @default(0) @map("is_sync_to_web")
  isSyncToLocal Int     @default(0) @map("is_sync_to_local")
  storeCode     String? @map("store_code") @db.VarChar(100)

  // Relationship
  shifts Shift[]

  @@map("tbl_station")
}

model Batch {
  batchId       BigInt    @id @default(autoincrement()) @map("batch_id")
  batchCode     String    @unique @map("batch_code") @db.VarChar(100)
  batchstart    DateTime? @map("batchstart")
  batchend      DateTime? @default(dbgenerated("NULL")) @map("batchend")
  isactive      Int       @default(1) @map("isactive")
  isbatchclose  Int       @default(0) @map("isbatchclose")
  isSyncToWeb   Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal Int       @default(0) @map("is_sync_to_local")
  storeCode     String?   @map("store_code") @db.VarChar(100)

  @@map("tbl_batch")
}

model Shift {
  shiftid        BigInt    @id @default(autoincrement()) @map("shiftid")
  shiftCode      String    @unique @map("shift_code") @db.VarChar(100)
  batchid        BigInt?   @map("batchid")
  batchCode      String?   @map("batch_code") @db.VarChar(100)
  shiftstart     DateTime? @map("shiftstart")
  shiftend       DateTime? @map("shiftend")
  shiftnumber    BigInt?   @map("shiftnumber")
  employeeid     BigInt?   @map("employeeid")
  isopen         Int       @default(1) @map("isopen")
  stationid      BigInt?   @map("stationid")
  stationCode    String?   @map("station_code") @db.VarChar(100)
  employeeuserid String?   @map("employeeuserid") @db.VarChar(20)
  isSyncToWeb    Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal  Int       @default(0) @map("is_sync_to_local")
  storeCode      String?   @map("store_code") @db.VarChar(100)

  // Relationship
  station Station? @relation(fields: [stationid], references: [tblStationId])

  @@map("tbl_shift")
}

model Printer {
  printerId     BigInt    @id @default(autoincrement()) @map("printer_id")
  printerCode   String    @unique @map("printer_code") @db.VarChar(100)
  printerName   String?   @map("printer_name") @db.VarChar(200)
  isActive      Int?      @map("is_active")
  createdBy     Int?      @map("createdby")
  createdOn     DateTime  @default(now()) @map("createdon")
  isSyncToWeb   Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal Int       @default(0) @map("is_sync_to_local")
  storeCode     String?   @map("store_code") @db.VarChar(100)

  // Relationships
  prepZones PrepZone[]

  @@map("tbl_printer")
}

model Table {
  tableId           Int      @id @default(autoincrement()) @map("table_id")
  tableNumber       String   @unique @map("table_number") @db.VarChar(50)
  seatingCapacity   Int      @map("seating_capacity")
  currentOccupancy  Int      @default(0) @map("current_occupancy")
  location          String?  @map("location") @db.VarChar(100)
  status            Int?     @map("status")
  createdDate       DateTime @default(now()) @map("created_date")
  isSyncToWeb       Int      @default(0) @map("is_sync_to_web")
  isSyncToLocal     Int      @default(0) @map("is_sync_to_local")
  storeCode         String?  @map("store_code") @db.VarChar(100)

  // Relationships
  orders Order[]

  @@map("tbl_table")
}

model Order {
  orderId        BigInt    @id @default(autoincrement()) @map("order_id")
  orderNumber    String    @unique @map("order_number") @db.VarChar(100)
  tableId        Int?      @map("table_id")
  orderType      String    @map("order_type") @db.VarChar(50) // DINE_IN, TAKEAWAY, DELIVERY, QR_ORDER
  status         String    @default("PENDING") @map("status") @db.VarChar(50) // PENDING, CONFIRMED, PREPARING, READY, SERVED, COMPLETED, CANCELLED
  customerName   String?   @map("customer_name") @db.VarChar(200)
  customerPhone  String?   @map("customer_phone") @db.VarChar(20)
  subtotal       Decimal   @default(0) @map("subtotal") @db.Decimal(10, 2)
  tax            Decimal   @default(0) @map("tax") @db.Decimal(10, 2)
  discount       Decimal   @default(0) @map("discount") @db.Decimal(10, 2)
  total          Decimal   @default(0) @map("total") @db.Decimal(10, 2)
  notes          String?   @map("notes")
  createdBy      Int?      @map("created_by")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  completedAt    DateTime? @map("completed_at")
  isSyncToWeb    Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal  Int       @default(0) @map("is_sync_to_local")
  storeCode      String?   @map("store_code") @db.VarChar(100)

  // Relationships
  table Table? @relation(fields: [tableId], references: [tableId])
  orderItems OrderItem[]

  @@map("tbl_order")
}

model OrderItem {
  orderItemId  BigInt    @id @default(autoincrement()) @map("order_item_id")
  orderId      BigInt    @map("order_id")
  menuItemId   BigInt?   @map("menu_item_id")
  menuItemCode String?   @map("menu_item_code") @db.VarChar(100)
  name         String    @map("name") @db.VarChar(500)
  quantity     Int       @default(1) @map("quantity")
  price        Decimal   @map("price") @db.Decimal(10, 2)
  subtotal     Decimal   @map("subtotal") @db.Decimal(10, 2)
  notes        String?   @map("notes")
  status       String    @default("PENDING") @map("status") @db.VarChar(50)
  createdAt    DateTime  @default(now()) @map("created_at")
  isSyncToWeb  Int       @default(0) @map("is_sync_to_web")
  isSyncToLocal Int      @default(0) @map("is_sync_to_local")
  storeCode    String?   @map("store_code") @db.VarChar(100)

  // Relationships
  order Order @relation(fields: [orderId], references: [orderId], onDelete: Cascade)

  @@map("tbl_order_item")
}

// Enums
enum UserRole {
  SUPER_ADMIN
  OUTLET_MANAGER
  CAPTAIN
  CASHIER
  KITCHEN_STAFF
}

